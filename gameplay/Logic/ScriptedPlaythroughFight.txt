Partition B9075C65-C11D-11E1-AA03-B50FE29FB811
SpatialPrefabBlueprint 4915D4AA-7DAE-CE38-5E71-20291FA352DB #primary instance
	$::PrefabBlueprint
		$::Blueprint
			$::EntityBusData
				$::DataBusData
					$::Asset
						$::DataContainer
						Name Gameplay/Logic/ScriptedPlaythroughFight
					PropertyConnections::array
						member(0)::PropertyConnection
							Source 258DB507-401B-4107-B90D-4EE2CB9C71CF
							Target FE54B0F7-D22C-4E9A-B97A-BE4E185DAEB1
							SourceFieldId 193442752
							TargetFieldId 5862146 (In)
							ShouldNetworkValue False
						member(1)::PropertyConnection
							Source FE54B0F7-D22C-4E9A-B97A-BE4E185DAEB1
							Target Instance0
							SourceFieldId 193453899 (Out)
							TargetFieldId 927994776 (TargetTransform)
							ShouldNetworkValue False
						member(2)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325234 (Enemy1)
							TargetFieldId -1952325234 (Enemy1)
							ShouldNetworkValue False
						member(3)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325235 (Enemy2)
							TargetFieldId -1952325235 (Enemy2)
							ShouldNetworkValue False
						member(4)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325236 (Enemy3)
							TargetFieldId -1952325236 (Enemy3)
							ShouldNetworkValue False
						member(5)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325237 (Enemy4)
							TargetFieldId -1952325237 (Enemy4)
							ShouldNetworkValue False
						member(6)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325238 (Enemy5)
							TargetFieldId -1952325238 (Enemy5)
							ShouldNetworkValue False
						member(7)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325239 (Enemy6)
							TargetFieldId -1952325239 (Enemy6)
							ShouldNetworkValue False
						member(8)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325240 (Enemy7)
							TargetFieldId -1952325240 (Enemy7)
							ShouldNetworkValue False
						member(9)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325241 (Enemy8)
							TargetFieldId -1952325241 (Enemy8)
							ShouldNetworkValue False
						member(10)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -1952325242 (Enemy9)
							TargetFieldId -1952325242 (Enemy9)
							ShouldNetworkValue False
						member(11)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223234 (Enemy10)
							TargetFieldId -2223234 (Enemy10)
							ShouldNetworkValue False
						member(12)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223233 (Enemy11)
							TargetFieldId -2223233 (Enemy11)
							ShouldNetworkValue False
						member(13)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223236
							TargetFieldId -2223236
							ShouldNetworkValue False
						member(14)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223235
							TargetFieldId -2223235
							ShouldNetworkValue False
						member(15)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223238
							TargetFieldId -2223238
							ShouldNetworkValue False
						member(16)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223237
							TargetFieldId -2223237
							ShouldNetworkValue False
						member(17)::PropertyConnection
							Source Instance2
							Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
							SourceFieldId -2223240
							TargetFieldId -2223240
							ShouldNetworkValue False
						member(18)::PropertyConnection
							Source FE54B0F7-D22C-4E9A-B97A-BE4E185DAEB1
							Target Instance2
							SourceFieldId 193453899 (Out)
							TargetFieldId 193442752
							ShouldNetworkValue False
					LinkConnections *nullArray*
					Interface Instance2
					Flags 3
				EventConnections::array
					member(0)::EventConnection
						Source Instance2
						Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
						SourceEvent::EventSpec
							Id 230748069 (Start)
						TargetEvent::EventSpec
							Id -1746878587 (StartExecutingPerFrame)
						TargetType EventConnectionTargetType_Server
					member(1)::EventConnection
						Source Instance2
						Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
						SourceEvent::EventSpec
							Id 2089401213 (Stop)
						TargetEvent::EventSpec
							Id -1592264995 (StopExecutingPerFrame)
						TargetType EventConnectionTargetType_Server
					member(2)::EventConnection
						Source Instance2
						Target 258DB507-401B-4107-B90D-4EE2CB9C71CF
						SourceEvent::EventSpec
							Id 2089401213 (Stop)
						TargetEvent::EventSpec
							Id 2089401213 (Stop)
						TargetType EventConnectionTargetType_Server
					member(3)::EventConnection
						Source 258DB507-401B-4107-B90D-4EE2CB9C71CF
						Target Instance0
						SourceEvent::EventSpec
							Id -1188560160
						TargetEvent::EventSpec
							Id 230748069 (Start)
						TargetType EventConnectionTargetType_NetworkedClient
					member(4)::EventConnection
						Source 258DB507-401B-4107-B90D-4EE2CB9C71CF
						Target Instance0
						SourceEvent::EventSpec
							Id -2101777096
						TargetEvent::EventSpec
							Id 2089401213 (Stop)
						TargetType EventConnectionTargetType_NetworkedClient
					member(5)::EventConnection
						Source Instance3
						Target Instance2
						SourceEvent::EventSpec
							Id 230748069 (Start)
						TargetEvent::EventSpec
							Id -568030115 (StartFire)
						TargetType EventConnectionTargetType_Server
					member(6)::EventConnection
						Source Instance3
						Target Instance2
						SourceEvent::EventSpec
							Id 2089401213 (Stop)
						TargetEvent::EventSpec
							Id -639132411 (StopFire)
						TargetType EventConnectionTargetType_Server
					member(7)::EventConnection
						Source 258DB507-401B-4107-B90D-4EE2CB9C71CF
						Target Instance3
						SourceEvent::EventSpec
							Id -568030115 (StartFire)
						TargetEvent::EventSpec
							Id 230748069 (Start)
						TargetType EventConnectionTargetType_Server
					member(8)::EventConnection
						Source 258DB507-401B-4107-B90D-4EE2CB9C71CF
						Target Instance3
						SourceEvent::EventSpec
							Id -639132411 (StopFire)
						TargetEvent::EventSpec
							Id 232316407 (Pause)
						TargetType EventConnectionTargetType_Server
					member(9)::EventConnection
						Source Instance3
						Target Instance1
						SourceEvent::EventSpec
							Id 1422499549
						TargetEvent::EventSpec
							Id 550586970 (Execute)
						TargetType EventConnectionTargetType_Server
		Objects::array
			member(0) Instance0
			member(1) 258DB507-401B-4107-B90D-4EE2CB9C71CF
			member(2) FE54B0F7-D22C-4E9A-B97A-BE4E185DAEB1
			member(3) Instance3
			member(4) Instance1
LuaRunnerScriptEntityData 258DB507-401B-4107-B90D-4EE2CB9C71CF
	$::EntityData
		$::GameObjectData
			$::DataBusPeer
				$::GameDataContainer
					$::DataContainer
				Flags 495826183
	Script -- If you change this, add more input transforms
local MAX_ENEMIES = 16
-- Other settings
local TIME_PER_TARGET = 3
local ACTIVITY_THRESHOLD = 4
local AIM_TIME = 1

local function lerp(s, e, t)
	return (1 - t) * s + t * e
end

local function update(self, vars)
	-- Check which enemies are still valid targets
	for i = 1, MAX_ENEMIES, 1 do
		local name = "Enemy" .. i
		if self[name] ~= nil then
			local new = self[name].trans
			local old = vars.enemies[i].pos
			if new.x ~= old.x or new.y ~= old.y or new.z ~= old.z then
				vars.enemies[i].lastActive = vars.time
				vars.enemies[i].pos.x = new.x
				vars.enemies[i].pos.y = new.y
				vars.enemies[i].pos.z = new.z
			end
		else
			vars.enemies[i].lastActive = -10000
		end
	end

	-- Time to decide new?
	if vars.time > vars.lastDecided + TIME_PER_TARGET then
		local available = {}
		for i = 1, MAX_ENEMIES, 1 do
			if vars.enemies[i].lastActive > vars.time - ACTIVITY_THRESHOLD then
				table.insert(available, i)
			end
		end
		if #available > 0 then
			-- Save old target pos for smooth aiming
			if vars.target ~= nil and  self["Enemy" .. vars.target] ~= nil then
				vars.oldTargetPos = self["Enemy" .. vars.target].trans
			end

			local chosen = math.random(#available)
			if vars.target ~= available[chosen] and vars.firing then
				self.FireEvent("StopFire")
				vars.firing = false
			end
			vars.target = available[chosen]
			vars.aimTime = vars.time
			vars.lastDecided = vars.time
		end
	end
	
	-- Set output transform and interpolate if needed
	if vars.target ~= nil then
		local doneAiming = false
		local aimTime = 0
		if vars.oldTargetPos == nil then
			doneAiming = true
		else
			aimTime = vars.time - vars.aimTime
			if aimTime >= AIM_TIME then
				doneAiming = true
			end
		end

		if not doneAiming then
			local old = vars.oldTargetPos
			local new = self["Enemy" .. vars.target].trans
			local fraction = aimTime / AIM_TIME
			local aimX = lerp(old.x, new.x, fraction)
			local aimY = lerp(old.y, new.y, fraction)
			local aimZ = lerp(old.z, new.z, fraction)
			self.Aim = LinearTransform.FromRotTrans(LinearTransform.Identity(), Vec3.FromXYZ(aimX, aimY, aimZ))
		else
			-- Set target directly
			self.Aim = self["Enemy" .. vars.target]
			if not vars.firing then
				self.FireEvent("StartFire")
				vars.firing = true
			end
		end
		self.FireEvent("StartAim")
	end
end

--function <guid>( self, event, vars, sharedvars, globalvars, deltaTime )
do
	if vars.enemies == nil then
		vars.enemies = {}
		for i = 1, MAX_ENEMIES, 1 do
			vars.enemies[i] = {}
			local name = "Enemy" .. i
			if self[name] ~= nil then
				local pos = self[name].trans
				vars.enemies[i].pos = { x = pos.x, y = pos.y, z = pos.z }
			else
				vars.enemies[i].pos = { x = 0, y = 0, z = 0 }
			end
			vars.enemies[i].lastActive = -10000
		end
	end
	InitVars(vars, "time", 0)
	InitVars(vars, "lastDecided", -10000)
	InitVars(vars, "firing", false)

	if event == "Stop" then
		self.FireEvent("StopFire")
		self.FireEvent("StopAim")
		vars.firing = false
	elseif event == "Execute" then
		vars.time = vars.time + deltaTime
		update(self, vars)
	end
end

	InputEvents::array
		member(0) Stop
	OutputEvents::array
		member(0) StartFire
		member(1) StopFire
		member(2) StartAim
		member(3) StopAim
	InputFloatProperties *nullArray*
	OutputFloatProperties *nullArray*
	InputIntProperties *nullArray*
	OutputIntProperties *nullArray*
	InputBoolProperties *nullArray*
	OutputBoolProperties *nullArray*
	InputStringProperties *nullArray*
	OutputStringProperties *nullArray*
	InputTransformProperties::array
		member(0) Enemy1
		member(1) Enemy2
		member(2) Enemy3
		member(3) Enemy4
		member(4) Enemy5
		member(5) Enemy6
		member(6) Enemy7
		member(7) Enemy8
		member(8) Enemy9
		member(9) Enemy10
		member(10) Enemy11
		member(11) Enemy12
		member(12) Enemy13
		member(13) Enemy14
		member(14) Enemy15
		member(15) Enemy16
	OutputTransformProperties::array
		member(0) Aim
	InputVec3Properties *nullArray*
	OutputVec3Properties *nullArray*
	ExecuteOnPropertyChange ExecuteOnPropertyChangeType_DontExecute
	PriorityForExecutingPerFrame 0
	Realm Realm_Server
	CompiledLua Gameplay/Logic/ScriptedPlaythroughFight/LuaRunnerCompiledLua_258DB507_401B_4107_B90D_4EE2CB9C71CF_Win32/18421984-E99F-BF53-A0AA-499E9181A236
	AutoStartExecutingPerFrame False
	AutoStartForInitialization False
	RunOnPropertyChange False
	AddToDebugDisplay False
SyncedTransformEntityData FE54B0F7-D22C-4E9A-B97A-BE4E185DAEB1
	$::EntityData
		$::GameObjectData
			$::DataBusPeer
				$::GameDataContainer
					$::DataContainer
				Flags 273985783
	Interpolate False
	In::LinearTransform
		right::Vec3
			x 1.0
			y 0.0
			z 0.0
		up::Vec3
			x 0.0
			y 1.0
			z 0.0
		forward::Vec3
			x 0.0
			y 0.0
			z 1.0
		trans::Vec3
			x 0.0
			y 0.0
			z 0.0
PlayerLookAtEntityData Instance0
	$::EntityData
		$::GameObjectData
			$::DataBusPeer
				$::GameDataContainer
					$::DataContainer
				Flags 443644914
	TargetTransform::LinearTransform
		right::Vec3
			x 1.0
			y 0.0
			z 0.0
		up::Vec3
			x 0.0
			y 1.0
			z 0.0
		forward::Vec3
			x 0.0
			y 0.0
			z 1.0
		trans::Vec3
			x 0.0
			y 0.0
			z 0.0
ConsoleCommandEntityData Instance1
	$::EntityData
		$::GameObjectData
			$::DataBusPeer
				$::GameDataContainer
					$::DataContainer
				Flags 70176080
	Commands::array
		member(0) Ai2.KillOneAi true
	Realm Realm_Server
InterfaceDescriptorData Instance2
	$::DynamicDataContainer
		$::DataContainer
		Fields::array
			member(0)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325234 (Enemy1)
				AccessType FieldAccessType_Target
			member(1)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325235 (Enemy2)
				AccessType FieldAccessType_Target
			member(2)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325236 (Enemy3)
				AccessType FieldAccessType_Target
			member(3)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325237 (Enemy4)
				AccessType FieldAccessType_Target
			member(4)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325238 (Enemy5)
				AccessType FieldAccessType_Target
			member(5)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325239 (Enemy6)
				AccessType FieldAccessType_Target
			member(6)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325240 (Enemy7)
				AccessType FieldAccessType_Target
			member(7)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325241 (Enemy8)
				AccessType FieldAccessType_Target
			member(8)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -1952325242 (Enemy9)
				AccessType FieldAccessType_Target
			member(9)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223234 (Enemy10)
				AccessType FieldAccessType_Target
			member(10)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223233 (Enemy11)
				AccessType FieldAccessType_Target
			member(11)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223236
				AccessType FieldAccessType_Target
			member(12)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223235
				AccessType FieldAccessType_Target
			member(13)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223238
				AccessType FieldAccessType_Target
			member(14)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223237
				AccessType FieldAccessType_Target
			member(15)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id -2223240
				AccessType FieldAccessType_Target
			member(16)::DataField
				Value *nullString*
				ValueRef *nullGuid*
				Id 193442752
				AccessType FieldAccessType_Source
	InputEvents::array
		member(0)::DynamicEvent
			Id 230748069 (Start)
		member(1)::DynamicEvent
			Id 2089401213 (Stop)
	OutputEvents::array
		member(0)::DynamicEvent
			Id -568030115 (StartFire)
		member(1)::DynamicEvent
			Id -639132411 (StopFire)
	InputLinks *nullArray*
	OutputLinks *nullArray*
SequenceEntityData Instance3
	$::EntityData
		$::GameObjectData
			$::DataBusPeer
				$::GameDataContainer
					$::DataContainer
				Flags 83781235
	Events::array
		member(0)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 0
		member(1)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 181
		member(2)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 986
		member(3)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 1470
		member(4)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 1923
		member(5)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 2026
		member(6)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 3139
		member(7)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 3212
		member(8)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 3799
		member(9)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 4101
		member(10)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 5190
		member(11)::SequenceEventData
			Event::EventSpec
				Id 1422499549
			Time 5420
		member(12)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 6557
		member(13)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 7156
		member(14)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 7319
		member(15)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 8009
		member(16)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 8402
		member(17)::SequenceEventData
			Event::EventSpec
				Id 230748069 (Start)
			Time 9261
		member(18)::SequenceEventData
			Event::EventSpec
				Id 1422499549
			Time 9384
		member(19)::SequenceEventData
			Event::EventSpec
				Id 2089401213 (Stop)
			Time 9431
	SequenceStartTime 0
	SequenceLength 10000
	Realm Realm_Server
	PropertyTracks *nullArray*
	CustomSequenceTracks *nullArray*
	ClientUpdatePass UpdatePass_PostFrame
	ServerUpdatePass UpdatePass_PreSim
	ExternalTime 0.0
	PlaybackSpeed 1.0
	Looping True
	AutoStart False
	AutoPlayFirstFrame False
	PlayInReverse False
